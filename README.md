# ADB Wi‑Fi Auto Install (adb-wifi-autoinstall)

このリポジトリには、Wi‑Fi経由のADB接続を監視しつつ、監視ディレクトリに出力される最新の APK を自動で端末にインストールする PowerShell スクリプト `adb-wifi-autoinstall.ps1` が含まれます。

主に XREAL 向け Unity 開発者（Wi‑Fi 経由で ADB 接続を維持しつつ、ビルドとインストールは行いたいが Unity の Run を実行したくない方）を想定しています。

---

## 目次

- [概要](#概要)
- [想定ユーザー](#想定ユーザー)
- [機能](#機能)
- [前提・動作環境](#前提・動作環境)
- [使い方（クイックスタート）](#使い方クイックスタート)
- [設定（パラメータ）](#設定パラメータ)
- [出力・ログ](#出力ログ)
- [セキュリティ・注意事項](#セキュリティ注意事項)
- [AI 生成についての明示](#ai-生成についての明示)
- [貢献・ライセンス](#貢献ライセンス)

---

## 概要

`adb-wifi-autoinstall.ps1` は以下の要素を組み合わせたユーティリティです。

- ADB 接続のウォッチドッグ: 端末が切断された場合、自動で再接続を試みます（USB が接続されている場合は `adb tcpip` を使って復旧を試行します）。
- APK 更新監視: 指定ディレクトリの最新 APK を監視し、更新があれば自動で `adb install` を実行します。
- FileSystemWatcher の取りこぼし対策としてポーリングを実装。
- ログは重要イベントのみ改行して出力し、接続OKは同一行を上書きすることでログノイズを抑えます。

## 想定ユーザー

- XREAL 向けやその他 Android ヘッドセットの Unity 開発者
- Wi‑Fi 経由で ADB を使ってデバッグ/インストールしたいが、Unity Editor の Run（Play）を使わずに外部でビルド→インストールを回したい方

## 機能

- ADB 接続監視と自動復旧（USB 接続がある場合は tcpip を有効化して復旧を試行）
- 指定フォルダ（デフォルトはスクリプト起動ディレクトリ）の APK 更新検出 → 自動インストール
- FileSystemWatcher + ポーリングの二重検知で検出精度を向上
- デバイス接続の逐次ステータス表示（同一行更新）
- インストール結果に応じて音で通知（Windows 標準音）

## 前提・動作環境

- Windows（PowerShell 5.1）
- adb が PATH に通っていること（adb が利用可能であること）
- 端末の USB デバッグが有効であること
- 初回は USB 接続で端末の IP を取得できること（tcpip 有効化のため）

## 使い方（クイックスタート）

1. このリポジトリをクローンまたはダウンロードして作業ディレクトリに移動します。
2. PowerShell を管理者で開く必要はほとんどありませんが、ExecutionPolicy によってはスクリプト実行を許可する必要があります。
3. スクリプトを実行します（例）:

```powershell
# スクリプトをカレントディレクトリで実行
powershell -ExecutionPolicy Bypass -File "adb-wifi-autoinstall.ps1"

# 別パラメータで実行する例
powershell -ExecutionPolicy Bypass -File "adb-wifi-autoinstall.ps1" -Port 5555 -WatchDir "C:\path\to\apk_dir" -ApkFilter "*.apk" -IntervalSec 5
```

実行後、WatchDir にある最新の APK をスクリプトが記憶し、以降の更新を検出して自動で端末へインストールします。

## 設定（パラメータ）

スクリプトのパラメータ（デフォルト）：

- Port (int) = 5555 — adb tcpip 用ポート
- IntervalSec (int) = 5 — ADB ウォッチドッグやメインループの待機間隔（秒）
- WatchDir (string) = スクリプト起動ディレクトリ — APK を監視するディレクトリ
- ApkFilter (string) = "*.apk" — 監視するファイルのフィルタ
- DebounceMs (int) = 1200 — FileSystemWatcher のデバウンス時間（ミリ秒）
- PollApkEverySec (int) = 5 — ポーリング間隔（秒）

コマンドラインからパラメータを指定して上書きできます（上の実行例参照）。

## 出力・ログ

- 通常は接続 OK のステータスは同一行を上書きして表示されます。
- 重要イベント（接続失敗、接続復旧、APK 更新検知、インストール結果など）はタイムスタンプ付きで改行して出力されます。
- インストール成功/失敗時に Windows のシステム音で通知します（環境によっては音が鳴らない場合があります）。

## セキュリティ・注意事項

- このスクリプトは端末の adb インタフェースを操作します。公開環境や不特定多数が接続するネットワーク上での運用には十分注意してください。
- 自動インストールを行うため、誤った APK をインストールしてしまうリスクがあります。監視ディレクトリの管理は慎重に行ってください。
- スクリプトを配布・実運用する前に必ずコードレビューとテストを行ってください。

## AI 生成についての明示

このリポジトリ内の一部ファイル（例: `adb-wifi-autoinstall.ps1`）には、AI（生成モデル）による生成または編集支援が含まれています。

- 影響: AI 支援により実装とドキュメントが作成されていますが、最終的なレビュー、テスト、運用判断は人間の担当者が行ってください。
- 表示例（スクリプト内にも同様の注記を含めています）: "このファイルにはAI（生成モデル）による生成または編集支援が含まれます。"

この明示は、AI による自動生成であることを利用者に透明に伝える目的で含めています。

## 貢献・ライセンス

- バグ修正や改善提案は Pull Request を通して歓迎します。小さな改善（ドキュメントの改善、パラメータ追加など）は PR で送ってください。
- ライセンスファイルが同梱されていない場合は、配布方針に応じて `LICENSE` を追加してください（MIT などの緩いライセンスを採用する場合が多いです）。

---

必要なら、この README に英訳版や、Windows 以外（macOS / Linux）での運用メモ、CI 自動ビルドや GitHub Actions による APK 配布フローの例などを追加します。要望があれば追記します。

